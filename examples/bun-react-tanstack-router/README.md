# File-Based Routing with Bun Macros & TanStack Router

This example demonstrates a file-based routing system for React applications using:

- **Bun macros** for compile-time route generation
- **TanStack Router** for client-side routing
- **FileRouter.ts** for route parsing and validation
- **File-system based route conventions**

## Route File Structure

The routing system uses a file-system based approach with the following conventions:

```
src/routes/
├── +page.tsx                    # Root layout (/)
├── index/                       # Home page
│   └── +page.tsx               # Component for / route
├── about/                      # About page
│   └── +page.tsx               # Component for /about route
└── users/                      # Users section
    ├── +page.tsx               # Layout for /users/* routes
    ├── index/                  # Users list page
    │   └── +page.tsx           # Component for /users route
    └── [userId]/               # Dynamic user detail page
        └── +page.tsx           # Component for /users/$userId route
```

## File Naming Conventions

### Directory Names

- **Literal routes**: `about/` → `/about`
- **Dynamic params**: `[userId]/` → `/$userId` (TanStack Router syntax)
- **Optional params**: `[[slug]]/` → `/slug?` (planned)
- **Rest params**: `[...path]/` → `/*` (planned)
- **Index routes**: `index/` → Represents the parent route without additional path

### File Names

- **+page.tsx**: Page component for the route
- **+server.ts**: Server-side handler (planned)

## Auto-Generated Router

The `routes.macro.tsx` file scans the `src/routes/` directory at compile time and generates a complete TanStack Router configuration:

```typescript
// Auto-generated by routes.macro.tsx
import {
  createHashHistory,
  createRootRoute,
  createRoute,
  createRouter,
} from "@tanstack/react-router"

import Component0 from "routes/about/+page"
import Component3 from "routes/index/+page"
import Component1 from "routes/users/+page"
import Component2 from "routes/users/[userId]/+page"
import RootLayoutComponent from "./routes/+page"

const rootRoute = createRootRoute({
  component: RootLayoutComponent,
})

const route0 = createRoute({
  getParentRoute: () => rootRoute,
  path: "/about",
  component: Component0,
})

// ... more routes

const routeTree = rootRoute.addChildren([
  route0,
  route1,
  route2,
  route3,
])

export const router = createRouter({
  routeTree,
  history: createHashHistory(),
})
```

## Component Structure

### Root Layout (`src/routes/+page.tsx`)

```tsx
import { Link, Outlet } from "@tanstack/react-router"
import React from "react"

export default function RootLayout() {
  return (
    <div>
      <nav>
        <Link to="/">Home</Link>
        <Link to="/about">About</Link>
        <Link to="/users">Users</Link>
      </nav>
      <main>
        <Outlet />
      </main>
    </div>
  )
}
```

### Dynamic Route (`src/routes/users/[userId]/+page.tsx`)

```tsx
import React from "react"

interface UserDetailPageProps {
  params: { userId: string }
}

export default function UserDetailPage({ params }: UserDetailPageProps) {
  const { userId } = params
  // Component implementation...
}
```

## FileRouter Integration

The system leverages the `FileRouter.ts` utility which provides:

### Route Segment Types

- **Literal**: `"users"` → Regular path segment
- **DynamicParam**: `"userId"` → Variable path segment
- **OptionalParam**: `"userId"` → Optional path segment
- **RestParam**: `"...path"` → Catch-all segment

### Handle Types

- **PageHandle**: `"+page.tsx"` → React component
- **ServerHandle**: `"+server.ts"` → Server handler

### Core Functions

```typescript
// Extract segments from a file path
extractSegments(path: string): Segment[] | null

// Extract complete route information
extractRoute(path: string): Route | null

// Walk directory for routes
walkRoutesDirectory(dir: string): AsyncGenerator<Route>
```

## Development Workflow

1. **Create route files** following the naming conventions
2. **Build process** runs the macro to generate router configuration
3. **Router automatically includes** all discovered routes
4. **Type-safe navigation** with TanStack Router

## Benefits

- **Zero configuration**: Routes are discovered automatically
- **Type safety**: Full TypeScript support for params and navigation
- **Build-time optimization**: Route tree generated at compile time
- **Familiar conventions**: Similar to Next.js App Router and SvelteKit
- **Extensible**: Easy to add server-side handling and more features

## Testing

Run the route discovery test:

```bash
bun run src/test-routes.ts
```

Generate and view router code:

```bash
bun run src/test-macro.ts
```

## Future Enhancements

- **Nested layouts**: Support for layout hierarchies
- **Server-side rendering**: Integration with +server.ts files
- **Route guards**: Authentication and authorization
- **Data loading**: Built-in data fetching patterns
- **Error boundaries**: Automatic error handling for routes
